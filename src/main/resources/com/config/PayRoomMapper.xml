<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.config.PayRoomMapper">

    <select id="selectPayRoom" parameterType="int" resultType="PayRoomDTO">
        select pr_idx, room_name, date_format(create_date,'%Y-%m-%d') as create_date
        from PAYROOM
        where m_idx = #{m_idx}
        order by create_date desc
    </select>

    <insert id="insertPayRoom" parameterType="PayRoomDTO" useGeneratedKeys="true" keyProperty="pr_idx">
        insert into PAYROOM (m_idx,room_name) values (#{m_idx},#{room_name});
    </insert>

    <insert id="insertMemberList" parameterType="PayRoomDTO">
        INSERT INTO PAYGROUPMEMBER (PR_IDX,paymember_name)
        values
<foreach collection="groupMemberList" index="index" item="item" separator=",">
         (#{pr_idx},#{item.payMember_name})
</foreach>
    </insert>

    <resultMap id="payRoom" type="PayRoomDTO">
        <id property="pr_idx" column="pr_idx"></id>
        <result property="m_idx" column="m_idx"></result>
        <result property="room_name" column="room_name"></result>
        <result property="create_date" column="create_date"></result>
        <collection property="groupMemberList" column="pr_idx" javaType="java.util.ArrayList" ofType="PayGroupMemberDTO" select="selectPayRoomGroupMember">
        </collection>
    </resultMap>

    <select id="selectPayRoomGroupMember" resultType="PayGroupMemberDTO">
        select pr_idx, prgm_idx, PAYMEMBER_NAME, PAYMEMBER_ACCOUNT, PAYMEMBER_BANK
        from PAYGROUPMEMBER
        where PR_IDX = #{pr_idx}
    </select>
    <select id="selectPayRoomRetrieve" resultMap="payRoom" parameterType="hashmap">
        select pr_idx, m_idx, room_name, date_format(create_date,'%Y-%m-%d') as create_date
        from PAYROOM
        where PR_IDX = #{pr_idx} and m_idx = #{m_idx}
    </select>

    <update id="updateAccount" parameterType="map">
        UPDATE PAYGROUPMEMBER
        SET
            paymember_account = #{payMember_account},
            paymember_bank = #{payMember_bank}
        where prgm_idx = #{prgm_idx}
    </update>

    <delete id="accountNull" parameterType="int">
        UPDATE PAYGROUPMEMBER
        SET
            paymember_account = NULL,
            paymember_bank = NULL
        where prgm_idx = #{prgm_idx}
    </delete>

</mapper>